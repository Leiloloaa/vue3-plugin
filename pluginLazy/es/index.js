import{Lazyload as i}from"vant";import m from"./Lazy.vue_vue_type_script_setup_true_lang.js";const f=(()=>{try{return document.createElement("canvas").toDataURL("image/webp",.5).startsWith("data:image/webp")}catch{return!1}})(),l=e=>f&&!/webp$/.test(e.value)&&e.modifiers.webp&&!e.value.includes("?x-oss-process=image"),a=e=>l(e)?e.value+"?x-oss-process=image/format,webp":e.value;function d(e,t){const r=()=>{console.info("\u56FE\u7247\u62A5\u9519\u4E86===",t.value),e.src=t.value,e.removeEventListener("error",r)};e._hasLazyListener||(e.addEventListener("error",r),e._hasLazyListener=!0),e.src=a(t)}function v(e,t){e.style.backgroundImage=`url('${a(t)}')`,e.style.backgroundSize="100% 100%"}function o(e,t){return t.modifiers.bg?v(e,t):d(e,t)}const y={beforeMount(e,t){e._hasLazyListener=!1;function r(){const s=new IntersectionObserver((n,c)=>{n.forEach(u=>{u.isIntersecting&&(o(e,t),c.unobserve(e))})},{threshold:0});s==null||s.observe(e)}window.IntersectionObserver?r():o(e,t)},updated(e,t){o(e,t)}},L=e=>{e.use(i,{lazyComponent:!0});const{directives:t,components:r}=e._context;delete t.lazy,delete r.Lazy,e.directive("lazy",y),e.component("Lazy",m)};export{L as default,y as lazyBody};
